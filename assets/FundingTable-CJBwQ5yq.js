import{j as e}from"./index-B-LG5Rxt.js";import{r as a}from"./vendor-DNUq6Z2j.js";import{o as t,B as l,e as n,p as r,n as s,U as d,q as i,F as c,M as o,I as m,t as h,D as u,s as x,u as p,v as j,P as g,w as y,x as b}from"./antd-D5FdCdN7.js";import{d as f}from"./dataStore-3eiAzKA8.js";import{A as I,a as v,C as k,D as w,F as D,b as N,P as A,g as C}from"./constants-CBYXbN9T.js";import{b as F,e as S,i as U,c as q,d as $}from"./excelUtils-BL5kLArp.js";import{u as E}from"./router-BKaa_vRn.js";import"./utils-B_sx4vTC.js";const{Option:T}=h,{TextArea:Y}=m,L=()=>{const L=E(),[M,O]=a.useState([]),[P,V]=a.useState(!1),[z,B]=a.useState(!1),[J,Q]=a.useState(null),[G]=t.useForm();a.useEffect(()=>{H()},[]);const H=()=>{const e=f.getFundingArrangement();O(e.map((e,a)=>({...e,key:a})))},K=[{title:"项目名称",dataIndex:"projectName",key:"projectName",width:200,fixed:"left"},{title:"项目编码",dataIndex:"projectCode",key:"projectCode",width:150},{title:"所属区域",dataIndex:"area",key:"area",width:120},{title:"项目类别",dataIndex:"category",key:"category",width:120},{title:"建设单位",dataIndex:"constructionUnit",key:"constructionUnit",width:150},{title:"项目主管部门",dataIndex:"department",key:"department",width:150},{title:"概算批复金额(万元)",dataIndex:"budgetAmount",key:"budgetAmount",width:150,render:e=>e?`${Number(e).toLocaleString()}`:""},{title:"资金批复金额(万元)",dataIndex:"fundingAmount",key:"fundingAmount",width:150,render:e=>e?`${Number(e).toLocaleString()}`:""},{title:"批复日期",dataIndex:"approvalDate",key:"approvalDate",width:120},{title:"资金具体来源",dataIndex:"fundingSource",key:"fundingSource",width:180},{title:"资金性质",dataIndex:"fundingNature",key:"fundingNature",width:100,render:a=>e.jsx("span",{style:{color:{"地方":"#52c41a","中央":"#1890ff","省级":"#722ed1"}[a]||"#666"},children:a})},{title:"财预文号",dataIndex:"documentNumber",key:"documentNumber",width:150},{title:"经办人",dataIndex:"operator",key:"operator",width:100},{title:"经办处室",dataIndex:"operatorDepartment",key:"operatorDepartment",width:150},{title:"项目状态",dataIndex:"status",key:"status",width:100},{title:"备注",dataIndex:"remark",key:"remark",width:200},{title:"操作",key:"action",width:120,fixed:"right",render:(a,t,n)=>e.jsxs(p,{children:[e.jsx(l,{type:"link",icon:e.jsx(j,{}),onClick:()=>R(t,n),children:"编辑"}),e.jsx(g,{title:"确定删除这条记录吗？",onConfirm:()=>W(n),okText:"确定",cancelText:"取消",children:e.jsx(l,{type:"link",danger:!0,icon:e.jsx(y,{}),children:"删除"})})]})}],R=(e,a)=>{Q({...e,index:a}),G.setFieldsValue({...e,approvalDate:e.approvalDate?b(e.approvalDate):null}),B(!0)},W=e=>{f.deleteFundingArrangement(e),H(),x.success("删除成功")};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx(l,{icon:e.jsx(n,{}),onClick:()=>L("/basic-data"),className:"back-button",children:"返回基础数据"}),e.jsx("h2",{style:{margin:"16px 0",color:"#333"},children:"资金安排表"})]}),e.jsxs("div",{className:"content-container",children:[e.jsxs("div",{className:"table-actions",children:[e.jsx(l,{type:"primary",icon:e.jsx(r,{}),onClick:()=>{Q(null),G.resetFields(),B(!0)},children:"添加资金安排"}),e.jsx(l,{icon:e.jsx(s,{}),onClick:()=>{if(0===M.length)return void x.warning("没有数据可导出");const e=F(M);S(e,"资金安排表","资金安排")?x.success("导出成功"):x.error("导出失败")},children:"导出Excel"}),e.jsx(d,{accept:".xlsx,.xls",showUploadList:!1,beforeUpload:async a=>{V(!0);try{const t=await U(a);if(0===t.length)return x.warning("Excel文件中没有数据"),!1;const l=q(t);if(l.length>0)return o.error({title:"数据验证失败",content:e.jsxs("div",{children:[e.jsx("p",{children:"发现以下错误："}),e.jsxs("ul",{children:[l.slice(0,10).map((a,t)=>e.jsx("li",{children:a},t)),l.length>10&&e.jsxs("li",{children:["... 还有 ",l.length-10," 个错误"]})]})]})}),!1;const n=$(t);return f.setFundingArrangement(n),H(),x.success(`成功导入 ${t.length} 条记录`),!1}catch(t){return x.error("导入失败: "+t.message),!1}finally{V(!1)}},children:e.jsx(l,{icon:e.jsx(i,{}),loading:P,children:"导入Excel"})})]}),e.jsx(c,{columns:K,dataSource:M,scroll:{x:2e3,y:600},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),e.jsx(o,{title:J?"编辑资金安排":"添加资金安排",open:z,onOk:async()=>{try{const e=await G.validateFields(),a={...e,approvalDate:e.approvalDate?e.approvalDate.format("YYYY-MM-DD"):""};J?(f.updateFundingArrangement(J.index,a),x.success("更新成功")):(f.addFundingArrangement(a),x.success("添加成功")),B(!1),H()}catch(e){}},onCancel:()=>B(!1),width:800,destroyOnClose:!0,children:e.jsxs(t,{form:G,layout:"vertical",children:[e.jsx(t.Item,{name:"projectName",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(m,{placeholder:"请输入项目名称"})}),e.jsx(t.Item,{name:"projectCode",label:"项目编码",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(m,{placeholder:"请输入项目编码"})}),e.jsx(t.Item,{name:"area",label:"所属区域",children:e.jsx(h,{placeholder:"请选择所属区域",children:I.map(a=>e.jsx(T,{value:a,children:a},a))})}),e.jsx(t.Item,{name:"category",label:"项目类别",children:e.jsx(h,{placeholder:"请选择项目类别",children:v.map(a=>e.jsx(T,{value:a,children:a},a))})}),e.jsx(t.Item,{name:"constructionUnit",label:"建设单位",children:e.jsx(h,{placeholder:"请选择建设单位",children:k.map(a=>e.jsx(T,{value:a,children:a},a))})}),e.jsx(t.Item,{name:"department",label:"项目主管部门",children:e.jsx(h,{placeholder:"请选择项目主管部门",children:w.map(a=>e.jsx(T,{value:a,children:a},a))})}),e.jsx(t.Item,{name:"budgetAmount",label:"概算批复金额(万元)",rules:[{pattern:/^\d+(\.\d+)?$/,message:"请输入有效的金额"}],children:e.jsx(m,{placeholder:"请输入概算批复金额"})}),e.jsx(t.Item,{name:"fundingAmount",label:"资金批复金额(万元)",rules:[{required:!0,message:"请输入资金批复金额"},{pattern:/^\d+(\.\d+)?$/,message:"请输入有效的金额"}],children:e.jsx(m,{placeholder:"请输入资金批复金额"})}),e.jsx(t.Item,{name:"approvalDate",label:"批复日期",children:e.jsx(u,{placeholder:"请选择批复日期",style:{width:"100%"}})}),e.jsx(t.Item,{name:"fundingSource",label:"资金具体来源",rules:[{required:!0,message:"请选择资金具体来源"}],children:e.jsx(h,{placeholder:"请选择资金具体来源",onChange:e=>{const a=C(e);G.setFieldValue("fundingNature",a)},children:D.map(a=>e.jsx(T,{value:a.value,children:a.label},a.value))})}),e.jsx(t.Item,{name:"fundingNature",label:"资金性质",rules:[{required:!0,message:"请选择资金性质"}],children:e.jsx(h,{placeholder:"请选择资金性质",children:N.map(a=>e.jsx(T,{value:a.value,children:a.label},a.value))})}),e.jsx(t.Item,{name:"documentNumber",label:"财预文号",children:e.jsx(m,{placeholder:"请输入财预文号"})}),e.jsx(t.Item,{name:"operator",label:"经办人",children:e.jsx(m,{placeholder:"请输入经办人"})}),e.jsx(t.Item,{name:"operatorDepartment",label:"经办处室",children:e.jsx(m,{placeholder:"请输入经办处室"})}),e.jsx(t.Item,{name:"status",label:"项目状态",children:e.jsx(h,{placeholder:"请选择项目状态",children:A.map(a=>e.jsx(T,{value:a.value,children:a.label},a.value))})}),e.jsx(t.Item,{name:"remark",label:"备注",children:e.jsx(Y,{placeholder:"请输入备注",rows:3})})]})})]})]})};export{L as default};
