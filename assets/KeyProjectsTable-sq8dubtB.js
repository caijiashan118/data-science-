import{j as e}from"./index-C-vQH0sd.js";import{r as t}from"./vendor-DNUq6Z2j.js";import{o as s,B as a,e as r,p as l,n,U as i,q as c,F as o,M as d,I as m,t as x,s as h,y as j,u,v as p,P as y,w as v}from"./antd-D5FdCdN7.js";import{d as g}from"./dataStore-3eiAzKA8.js";import{A as I,a as k,C as f,D as b,P as w}from"./constants-CBYXbN9T.js";import{e as C,i as P}from"./excelUtils-BL5kLArp.js";import{u as N}from"./router-BKaa_vRn.js";import"./utils-B_sx4vTC.js";const{Option:U}=x,{TextArea:q}=m,S=()=>{const S=N(),[L,F]=t.useState([]),[K,$]=t.useState(!1),[E,T]=t.useState(!1),[O,A]=t.useState(null),[z]=s.useForm();t.useEffect(()=>{B()},[]);const B=()=>{const e=g.getKeyProjects();F(e.map((e,t)=>({...e,key:t})))},D=[{title:"项目名称",dataIndex:"projectName",key:"projectName",width:200,fixed:"left"},{title:"项目编码",dataIndex:"projectCode",key:"projectCode",width:150},{title:"所属区域",dataIndex:"area",key:"area",width:120},{title:"项目类别",dataIndex:"category",key:"category",width:120},{title:"重点等级",dataIndex:"priorityLevel",key:"priorityLevel",width:120,render:t=>e.jsx(j,{color:{"国家级":"#f50","省级":"#2db7f5","市级":"#87d068","区级":"#108ee9"}[t],children:t})},{title:"建设单位",dataIndex:"constructionUnit",key:"constructionUnit",width:150},{title:"项目主管部门",dataIndex:"department",key:"department",width:150},{title:"总投资(万元)",dataIndex:"totalInvestment",key:"totalInvestment",width:150,render:e=>e?`${Number(e).toLocaleString()}`:""},{title:"建设周期",dataIndex:"constructionPeriod",key:"constructionPeriod",width:120},{title:"项目状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx("span",{style:{color:{"在建":"#52c41a","续建":"#1890ff","完工":"#722ed1","暂停":"#f5222d"}[t]||"#666"},children:t})},{title:"项目描述",dataIndex:"description",key:"description",width:300,ellipsis:!0},{title:"操作",key:"action",width:120,fixed:"right",render:(t,s,r)=>e.jsxs(u,{children:[e.jsx(a,{type:"link",icon:e.jsx(p,{}),onClick:()=>J(s,r),children:"编辑"}),e.jsx(y,{title:"确定删除这条记录吗？",onConfirm:()=>M(r),okText:"确定",cancelText:"取消",children:e.jsx(a,{type:"link",danger:!0,icon:e.jsx(v,{}),children:"删除"})})]})}],J=(e,t)=>{A({...e,index:t}),z.setFieldsValue(e),T(!0)},M=e=>{const t=[...L];t.splice(e,1),g.setKeyProjects(t),B(),h.success("删除成功")};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx(a,{icon:e.jsx(r,{}),onClick:()=>S("/basic-data"),className:"back-button",children:"返回基础数据"}),e.jsx("h2",{style:{margin:"16px 0",color:"#333"},children:"重点项目清单"})]}),e.jsxs("div",{className:"content-container",children:[e.jsxs("div",{className:"table-actions",children:[e.jsx(a,{type:"primary",icon:e.jsx(l,{}),onClick:()=>{A(null),z.resetFields(),T(!0)},children:"添加重点项目"}),e.jsx(a,{icon:e.jsx(n,{}),onClick:()=>{if(0===L.length)return void h.warning("没有数据可导出");const e=L.map(e=>({"项目名称":e.projectName,"项目编码":e.projectCode,"所属区域":e.area,"项目类别":e.category,"重点等级":e.priorityLevel,"建设单位":e.constructionUnit,"项目主管部门":e.department,"总投资(万元)":e.totalInvestment,"建设周期":e.constructionPeriod,"项目状态":e.status,"项目描述":e.description}));C(e,"重点项目清单","重点项目")?h.success("导出成功"):h.error("导出失败")},children:"导出Excel"}),e.jsx(i,{accept:".xlsx,.xls",showUploadList:!1,beforeUpload:async e=>{$(!0);try{const t=await P(e);if(0===t.length)return h.warning("Excel文件中没有数据"),!1;const s=t.map((e,t)=>({key:`import_${t}`,projectName:e["项目名称"]||"",projectCode:e["项目编码"]||"",area:e["所属区域"]||"",category:e["项目类别"]||"",priorityLevel:e["重点等级"]||"",constructionUnit:e["建设单位"]||"",department:e["项目主管部门"]||"",totalInvestment:e["总投资(万元)"]||"",constructionPeriod:e["建设周期"]||"",status:e["项目状态"]||"",description:e["项目描述"]||""}));return g.setKeyProjects(s),B(),h.success(`成功导入 ${t.length} 条记录`),!1}catch(t){return h.error("导入失败: "+t.message),!1}finally{$(!1)}},children:e.jsx(a,{icon:e.jsx(c,{}),loading:K,children:"导入Excel"})})]}),e.jsx(o,{columns:D,dataSource:L,scroll:{x:1800,y:600},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),e.jsx(d,{title:O?"编辑重点项目":"添加重点项目",open:E,onOk:async()=>{try{const e=await z.validateFields();if(O){const t=[...L];t[O.index]={...e,key:O.index},g.setKeyProjects(t),h.success("更新成功")}else{const t=[...L,{...e,key:L.length}];g.setKeyProjects(t),h.success("添加成功")}T(!1),B()}catch(e){}},onCancel:()=>T(!1),width:800,destroyOnClose:!0,children:e.jsxs(s,{form:z,layout:"vertical",children:[e.jsx(s.Item,{name:"projectName",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(m,{placeholder:"请输入项目名称"})}),e.jsx(s.Item,{name:"projectCode",label:"项目编码",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(m,{placeholder:"请输入项目编码"})}),e.jsx(s.Item,{name:"area",label:"所属区域",rules:[{required:!0,message:"请选择所属区域"}],children:e.jsx(x,{placeholder:"请选择所属区域",children:I.map(t=>e.jsx(U,{value:t,children:t},t))})}),e.jsx(s.Item,{name:"category",label:"项目类别",rules:[{required:!0,message:"请选择项目类别"}],children:e.jsx(x,{placeholder:"请选择项目类别",children:k.map(t=>e.jsx(U,{value:t,children:t},t))})}),e.jsx(s.Item,{name:"priorityLevel",label:"重点等级",rules:[{required:!0,message:"请选择重点等级"}],children:e.jsx(x,{placeholder:"请选择重点等级",children:[{value:"国家级",label:"国家级"},{value:"省级",label:"省级"},{value:"市级",label:"市级"},{value:"区级",label:"区级"}].map(t=>e.jsx(U,{value:t.value,children:t.label},t.value))})}),e.jsx(s.Item,{name:"constructionUnit",label:"建设单位",rules:[{required:!0,message:"请选择建设单位"}],children:e.jsx(x,{placeholder:"请选择建设单位",children:f.map(t=>e.jsx(U,{value:t,children:t},t))})}),e.jsx(s.Item,{name:"department",label:"项目主管部门",rules:[{required:!0,message:"请选择项目主管部门"}],children:e.jsx(x,{placeholder:"请选择项目主管部门",children:b.map(t=>e.jsx(U,{value:t,children:t},t))})}),e.jsx(s.Item,{name:"totalInvestment",label:"总投资(万元)",rules:[{pattern:/^\d+(\.\d+)?$/,message:"请输入有效的金额"}],children:e.jsx(m,{placeholder:"请输入总投资金额"})}),e.jsx(s.Item,{name:"constructionPeriod",label:"建设周期",children:e.jsx(m,{placeholder:"如：2023-2025年"})}),e.jsx(s.Item,{name:"status",label:"项目状态",children:e.jsx(x,{placeholder:"请选择项目状态",children:w.map(t=>e.jsx(U,{value:t.value,children:t.label},t.value))})}),e.jsx(s.Item,{name:"description",label:"项目描述",children:e.jsx(q,{placeholder:"请输入项目描述",rows:4})})]})})]})]})};export{S as default};
