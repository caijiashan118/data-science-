import{j as e}from"./index-B-LG5Rxt.js";import{r as t}from"./vendor-DNUq6Z2j.js";import{o as a,B as s,e as l,p as r,n as i,U as n,q as d,F as c,M as o,I as m,t as h,D as x,s as j,u as p,v as u,P as y,w as f,x as g}from"./antd-D5FdCdN7.js";import{d as T}from"./dataStore-3eiAzKA8.js";import{A as I,a as v,C as w,D as k,P as b}from"./constants-CBYXbN9T.js";import{t as C,e as Y,i as D,v as N,a as S}from"./excelUtils-BL5kLArp.js";import{u as q}from"./router-BKaa_vRn.js";import"./utils-B_sx4vTC.js";const{Option:M}=h,P=()=>{const P=q(),[U,F]=t.useState([]),[A,E]=t.useState(!1),[$,O]=t.useState(!1),[L,z]=t.useState(null),[B]=a.useForm();t.useEffect(()=>{J()},[]);const J=()=>{const e=T.getProjectInfo();F(e.map((e,t)=>({...e,key:t})))},Q=[{title:"项目名称",dataIndex:"projectName",key:"projectName",width:200,fixed:"left"},{title:"项目编码",dataIndex:"projectCode",key:"projectCode",width:150},{title:"所属区域",dataIndex:"area",key:"area",width:120},{title:"项目类别",dataIndex:"category",key:"category",width:120},{title:"建设单位",dataIndex:"constructionUnit",key:"constructionUnit",width:150},{title:"项目主管部门",dataIndex:"department",key:"department",width:150},{title:"立项时间",dataIndex:"approvalTime",key:"approvalTime",width:120},{title:"概算批复金额(万元)",dataIndex:"budgetAmount",key:"budgetAmount",width:150,render:e=>e?`${Number(e).toLocaleString()}`:""},{title:"(预计)开工时间",dataIndex:"startTime",key:"startTime",width:120},{title:"(预计)完工时间",dataIndex:"endTime",key:"endTime",width:120},{title:"项目状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx("span",{style:{color:{"在建":"#52c41a","续建":"#1890ff","完工":"#722ed1","暂停":"#f5222d"}[t]||"#666"},children:t})},{title:"操作",key:"action",width:120,fixed:"right",render:(t,a,l)=>e.jsxs(p,{children:[e.jsx(s,{type:"link",icon:e.jsx(u,{}),onClick:()=>V(a,l),children:"编辑"}),e.jsx(y,{title:"确定删除这条记录吗？",onConfirm:()=>G(l),okText:"确定",cancelText:"取消",children:e.jsx(s,{type:"link",danger:!0,icon:e.jsx(f,{}),children:"删除"})})]})}],V=(e,t)=>{z({...e,index:t}),B.setFieldsValue({...e,approvalTime:e.approvalTime?g(e.approvalTime):null,startTime:e.startTime?g(e.startTime):null,endTime:e.endTime?g(e.endTime):null}),O(!0)},G=e=>{T.deleteProjectInfo(e),J(),j.success("删除成功")};return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx(s,{icon:e.jsx(l,{}),onClick:()=>P("/basic-data"),className:"back-button",children:"返回基础数据"}),e.jsx("h2",{style:{margin:"16px 0",color:"#333"},children:"项目基本信息表"})]}),e.jsxs("div",{className:"content-container",children:[e.jsxs("div",{className:"table-actions",children:[e.jsx(s,{type:"primary",icon:e.jsx(r,{}),onClick:()=>{z(null),B.resetFields(),O(!0)},children:"添加项目"}),e.jsx(s,{icon:e.jsx(i,{}),onClick:()=>{if(0===U.length)return void j.warning("没有数据可导出");const e=C(U);Y(e,"项目基本信息表","项目信息")?j.success("导出成功"):j.error("导出失败")},children:"导出Excel"}),e.jsx(n,{accept:".xlsx,.xls",showUploadList:!1,beforeUpload:async t=>{E(!0);try{const a=await D(t);if(0===a.length)return j.warning("Excel文件中没有数据"),!1;const s=N(a);if(s.length>0)return o.error({title:"数据验证失败",content:e.jsxs("div",{children:[e.jsx("p",{children:"发现以下错误："}),e.jsxs("ul",{children:[s.slice(0,10).map((t,a)=>e.jsx("li",{children:t},a)),s.length>10&&e.jsxs("li",{children:["... 还有 ",s.length-10," 个错误"]})]})]})}),!1;const l=S(a);return T.setProjectInfo(l),J(),j.success(`成功导入 ${a.length} 条记录`),!1}catch(a){return j.error("导入失败: "+a.message),!1}finally{E(!1)}},children:e.jsx(s,{icon:e.jsx(d,{}),loading:A,children:"导入Excel"})})]}),e.jsx(c,{columns:Q,dataSource:U,scroll:{x:1500,y:600},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),e.jsx(o,{title:L?"编辑项目":"添加项目",open:$,onOk:async()=>{try{const e=await B.validateFields(),t={...e,approvalTime:e.approvalTime?e.approvalTime.format("YYYY-MM-DD"):"",startTime:e.startTime?e.startTime.format("YYYY-MM-DD"):"",endTime:e.endTime?e.endTime.format("YYYY-MM-DD"):""};L?(T.updateProjectInfo(L.index,t),j.success("更新成功")):(T.addProjectInfo(t),j.success("添加成功")),O(!1),J()}catch(e){}},onCancel:()=>O(!1),width:800,destroyOnClose:!0,children:e.jsxs(a,{form:B,layout:"vertical",children:[e.jsx(a.Item,{name:"projectName",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(m,{placeholder:"请输入项目名称"})}),e.jsx(a.Item,{name:"projectCode",label:"项目编码",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(m,{placeholder:"请输入项目编码"})}),e.jsx(a.Item,{name:"area",label:"所属区域",rules:[{required:!0,message:"请选择所属区域"}],children:e.jsx(h,{placeholder:"请选择所属区域",children:I.map(t=>e.jsx(M,{value:t,children:t},t))})}),e.jsx(a.Item,{name:"category",label:"项目类别",rules:[{required:!0,message:"请选择项目类别"}],children:e.jsx(h,{placeholder:"请选择项目类别",children:v.map(t=>e.jsx(M,{value:t,children:t},t))})}),e.jsx(a.Item,{name:"constructionUnit",label:"建设单位",rules:[{required:!0,message:"请选择建设单位"}],children:e.jsx(h,{placeholder:"请选择建设单位",children:w.map(t=>e.jsx(M,{value:t,children:t},t))})}),e.jsx(a.Item,{name:"department",label:"项目主管部门",rules:[{required:!0,message:"请选择项目主管部门"}],children:e.jsx(h,{placeholder:"请选择项目主管部门",children:k.map(t=>e.jsx(M,{value:t,children:t},t))})}),e.jsx(a.Item,{name:"approvalTime",label:"立项时间",children:e.jsx(x,{placeholder:"请选择立项时间",style:{width:"100%"}})}),e.jsx(a.Item,{name:"budgetAmount",label:"概算批复金额(万元)",rules:[{pattern:/^\d+(\.\d+)?$/,message:"请输入有效的金额"}],children:e.jsx(m,{placeholder:"请输入概算批复金额"})}),e.jsx(a.Item,{name:"startTime",label:"(预计)开工时间",children:e.jsx(x,{placeholder:"请选择开工时间",style:{width:"100%"}})}),e.jsx(a.Item,{name:"endTime",label:"(预计)完工时间",children:e.jsx(x,{placeholder:"请选择完工时间",style:{width:"100%"}})}),e.jsx(a.Item,{name:"status",label:"项目状态",children:e.jsx(h,{placeholder:"请选择项目状态",children:b.map(t=>e.jsx(M,{value:t.value,children:t.label},t.value))})})]})})]})]})};export{P as default};
