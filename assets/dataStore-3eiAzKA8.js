const t=new class{constructor(){this.storageKey="cityConstructionData",this.data={projectInfo:[],fundingArrangement:[],keyProjects:[]},this.loadFromLocalStorage()}loadFromLocalStorage(){try{const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t);this.validateDataStructure(e)&&(this.data={...this.data,...e})}}catch(t){this.clearCorruptedData()}}validateDataStructure(t){return t&&"object"==typeof t&&Array.isArray(t.projectInfo)&&Array.isArray(t.fundingArrangement)&&Array.isArray(t.keyProjects)}clearCorruptedData(){try{localStorage.removeItem(this.storageKey)}catch(t){}}saveToLocalStorage(){try{const t=JSON.stringify(this.data);return localStorage.setItem(this.storageKey,t),!0}catch(t){return t.name,!1}}getProjectInfo(){return this.data.projectInfo}setProjectInfo(t){this.data.projectInfo=t,this.saveToLocalStorage()}addProjectInfo(t){this.data.projectInfo.push(t),this.saveToLocalStorage()}updateProjectInfo(t,e){this.data.projectInfo[t]=e,this.saveToLocalStorage()}deleteProjectInfo(t){this.data.projectInfo.splice(t,1),this.saveToLocalStorage()}getFundingArrangement(){return this.data.fundingArrangement}setFundingArrangement(t){this.data.fundingArrangement=t,this.saveToLocalStorage()}addFundingArrangement(t){this.data.fundingArrangement.push(t),this.saveToLocalStorage()}updateFundingArrangement(t,e){this.data.fundingArrangement[t]=e,this.saveToLocalStorage()}deleteFundingArrangement(t){this.data.fundingArrangement.splice(t,1),this.saveToLocalStorage()}getKeyProjects(){return this.data.keyProjects}setKeyProjects(t){this.data.keyProjects=t,this.saveToLocalStorage()}getProjectByCode(t){return this.data.projectInfo.find(e=>e.projectCode===t)}getFundingByProjectCode(t){return this.data.fundingArrangement.filter(e=>e.projectCode===t)}clearAllData(){return this.data={projectInfo:[],fundingArrangement:[],keyProjects:[]},this.saveToLocalStorage()}getDataStats(){return{projectCount:this.data.projectInfo.length,fundingCount:this.data.fundingArrangement.length,keyProjectCount:this.data.keyProjects.length,totalFunding:this.data.fundingArrangement.reduce((t,e)=>t+(parseFloat(e.approvedAmount)||0),0)}}exportData(){return JSON.stringify(this.data,null,2)}importData(t){try{const e=JSON.parse(t);if(this.validateDataStructure(e))return this.data=e,this.saveToLocalStorage();throw new Error("数据格式不正确")}catch(e){return!1}}backupData(){const t=(new Date).toISOString().replace(/[:.]/g,"-"),e=`${this.storageKey}_backup_${t}`;try{return localStorage.setItem(e,JSON.stringify(this.data)),e}catch(a){return null}}};export{t as d};
