import{j as e}from"./index-B-LG5Rxt.js";import{r as a}from"./vendor-DNUq6Z2j.js";import{d as n}from"./dataStore-3eiAzKA8.js";import{e as t}from"./excelUtils-BL5kLArp.js";import{u as l}from"./router-BKaa_vRn.js";import{s as d,S as i,B as r,e as c,E as s,g as o,h as u,i as g,m as p,c as m,T as F,n as y,F as x}from"./antd-D5FdCdN7.js";import{R as j,P as v,a as h,C as S,T as b,B,b as k,X as I,Y as N,L as f,c as w}from"./charts-Dc23VF4A.js";import"./utils-B_sx4vTC.js";const C=e=>{const a={};return e.forEach(e=>{const n=e.projectCode;a[n]||(a[n]={projectCode:e.projectCode,projectName:e.projectName,area:e.area,category:e.category,constructionUnit:e.constructionUnit,department:e.department,budgetAmount:e.budgetAmount,localFunding:0,centralFunding:0,provincialFunding:0,totalFunding:0,localGeneralBonds:0,localSpecialBonds:0,landSaleRevenue:0,generalPublicBudget:0,centralBudgetInvestment:0,centralSubsidy:0,centralSpecialFunds:0,treasuryBonds:0,ultraLongTreasuryBonds:0,antiEpidemicBonds:0,provincialSubsidy:0,provincialSpecialFunds:0});const t=Number(e.fundingAmount)||0,l=a[n];switch("地方"===e.fundingNature?l.localFunding+=t:"中央"===e.fundingNature?l.centralFunding+=t:"省级"===e.fundingNature&&(l.provincialFunding+=t),e.fundingSource){case"地方-一般债券":l.localGeneralBonds+=t;break;case"地方-专项债券":l.localSpecialBonds+=t;break;case"地方-土地出让金":l.landSaleRevenue+=t;break;case"地方-一般公共预算":l.generalPublicBudget+=t;break;case"中央-中央预算内投资":l.centralBudgetInvestment+=t;break;case"中央-中央补助":l.centralSubsidy+=t;break;case"中央-中央专项":l.centralSpecialFunds+=t;break;case"中央-国债":l.treasuryBonds+=t;break;case"中央-超长期国债":l.ultraLongTreasuryBonds+=t;break;case"中央-抗疫特别国债":l.antiEpidemicBonds+=t;break;case"省级-省级补助":l.provincialSubsidy+=t;break;case"省级-省级专项":l.provincialSpecialFunds+=t}l.totalFunding=l.localFunding+l.centralFunding+l.provincialFunding}),Object.values(a)},E=e=>e?Number(e).toLocaleString():"0",{TabPane:P}=F,L=()=>{const L=l(),[T,R]=a.useState(!1),[A,G]=a.useState(null),[D,K]=a.useState(null);a.useEffect(()=>{$()},[]);const $=()=>{R(!0);try{const e=n.getFundingArrangement();if(0===e.length)return d.warning("没有资金安排数据，请先在基础数据模块中添加数据"),G(null),void K(null);const a=(e=>{const a=C(e),n={totalProjects:a.length,totalBudget:a.reduce((e,a)=>e+(Number(a.budgetAmount)||0),0),totalFunding:a.reduce((e,a)=>e+a.totalFunding,0),totalLocalFunding:a.reduce((e,a)=>e+a.localFunding,0),totalCentralFunding:a.reduce((e,a)=>e+a.centralFunding,0),totalProvincialFunding:a.reduce((e,a)=>e+a.provincialFunding,0)},t={};a.forEach(e=>{t[e.area]||(t[e.area]={area:e.area,projectCount:0,totalFunding:0,localFunding:0,centralFunding:0,provincialFunding:0});const a=t[e.area];a.projectCount+=1,a.totalFunding+=e.totalFunding,a.localFunding+=e.localFunding,a.centralFunding+=e.centralFunding,a.provincialFunding+=e.provincialFunding});const l={};return a.forEach(e=>{l[e.category]||(l[e.category]={category:e.category,projectCount:0,totalFunding:0,localFunding:0,centralFunding:0,provincialFunding:0});const a=l[e.category];a.projectCount+=1,a.totalFunding+=e.totalFunding,a.localFunding+=e.localFunding,a.centralFunding+=e.centralFunding,a.provincialFunding+=e.provincialFunding}),{projectSummary:a,totalStats:n,areaStats:Object.values(t),categoryStats:Object.values(l)}})(e),t=(e=>{const a=C(e),n={localFundingDetails:{total:a.reduce((e,a)=>e+a.localFunding,0),generalBonds:a.reduce((e,a)=>e+a.localGeneralBonds,0),specialBonds:a.reduce((e,a)=>e+a.localSpecialBonds,0),landSaleRevenue:a.reduce((e,a)=>e+a.landSaleRevenue,0),generalPublicBudget:a.reduce((e,a)=>e+a.generalPublicBudget,0)},centralFundingDetails:{total:a.reduce((e,a)=>e+a.centralFunding,0),budgetInvestment:a.reduce((e,a)=>e+a.centralBudgetInvestment,0),subsidy:a.reduce((e,a)=>e+a.centralSubsidy,0),specialFunds:a.reduce((e,a)=>e+a.centralSpecialFunds,0),treasuryBonds:a.reduce((e,a)=>e+a.treasuryBonds,0),ultraLongTreasuryBonds:a.reduce((e,a)=>e+a.ultraLongTreasuryBonds,0),antiEpidemicBonds:a.reduce((e,a)=>e+a.antiEpidemicBonds,0)},provincialFundingDetails:{total:a.reduce((e,a)=>e+a.provincialFunding,0),subsidy:a.reduce((e,a)=>e+a.provincialSubsidy,0),specialFunds:a.reduce((e,a)=>e+a.provincialSpecialFunds,0)}},t={};return a.forEach(e=>{t[e.area]||(t[e.area]={area:e.area,localFunding:{total:0,generalBonds:0,specialBonds:0,landSaleRevenue:0,generalPublicBudget:0},centralFunding:{total:0,budgetInvestment:0,subsidy:0,specialFunds:0,treasuryBonds:0,ultraLongTreasuryBonds:0,antiEpidemicBonds:0},provincialFunding:{total:0,subsidy:0,specialFunds:0}});const a=t[e.area];a.localFunding.total+=e.localFunding,a.localFunding.generalBonds+=e.localGeneralBonds,a.localFunding.specialBonds+=e.localSpecialBonds,a.localFunding.landSaleRevenue+=e.landSaleRevenue,a.localFunding.generalPublicBudget+=e.generalPublicBudget,a.centralFunding.total+=e.centralFunding,a.centralFunding.budgetInvestment+=e.centralBudgetInvestment,a.centralFunding.subsidy+=e.centralSubsidy,a.centralFunding.specialFunds+=e.centralSpecialFunds,a.centralFunding.treasuryBonds+=e.treasuryBonds,a.centralFunding.ultraLongTreasuryBonds+=e.ultraLongTreasuryBonds,a.centralFunding.antiEpidemicBonds+=e.antiEpidemicBonds,a.provincialFunding.total+=e.provincialFunding,a.provincialFunding.subsidy+=e.provincialSubsidy,a.provincialFunding.specialFunds+=e.provincialSpecialFunds}),{projectSummary:a,detailedStats:n,areaFundingCrossStats:Object.values(t)}})(e);G(a),K(t),d.success("报表数据加载成功")}catch(e){d.error("加载报表数据失败")}finally{R(!1)}},O=[{title:"项目名称",dataIndex:"projectName",key:"projectName",width:200,fixed:"left"},{title:"项目编码",dataIndex:"projectCode",key:"projectCode",width:150},{title:"所属区域",dataIndex:"area",key:"area",width:120},{title:"项目类别",dataIndex:"category",key:"category",width:120},{title:"概算批复金额(万元)",dataIndex:"budgetAmount",key:"budgetAmount",width:150,render:e=>E(e)},{title:"地方资金合计(万元)",dataIndex:"localFunding",key:"localFunding",width:150,render:e=>E(e)},{title:"中央资金合计(万元)",dataIndex:"centralFunding",key:"centralFunding",width:150,render:e=>E(e)},{title:"省级资金合计(万元)",dataIndex:"provincialFunding",key:"provincialFunding",width:150,render:e=>E(e)},{title:"资金总计(万元)",dataIndex:"totalFunding",key:"totalFunding",width:150,render:e=>E(e)}],U=[{title:"项目名称",dataIndex:"projectName",key:"projectName",width:180,fixed:"left"},{title:"项目编码",dataIndex:"projectCode",key:"projectCode",width:120},{title:"地方资金",children:[{title:"一般债券",dataIndex:"localGeneralBonds",key:"localGeneralBonds",width:100,render:e=>E(e)},{title:"专项债券",dataIndex:"localSpecialBonds",key:"localSpecialBonds",width:100,render:e=>E(e)},{title:"土地出让金",dataIndex:"landSaleRevenue",key:"landSaleRevenue",width:100,render:e=>E(e)},{title:"一般公共预算",dataIndex:"generalPublicBudget",key:"generalPublicBudget",width:110,render:e=>E(e)}]},{title:"中央资金",children:[{title:"预算内投资",dataIndex:"centralBudgetInvestment",key:"centralBudgetInvestment",width:100,render:e=>E(e)},{title:"中央补助",dataIndex:"centralSubsidy",key:"centralSubsidy",width:100,render:e=>E(e)},{title:"中央专项",dataIndex:"centralSpecialFunds",key:"centralSpecialFunds",width:100,render:e=>E(e)},{title:"国债",dataIndex:"treasuryBonds",key:"treasuryBonds",width:80,render:e=>E(e)},{title:"超长期国债",dataIndex:"ultraLongTreasuryBonds",key:"ultraLongTreasuryBonds",width:100,render:e=>E(e)},{title:"抗疫特别国债",dataIndex:"antiEpidemicBonds",key:"antiEpidemicBonds",width:110,render:e=>E(e)}]},{title:"省级资金",children:[{title:"省级补助",dataIndex:"provincialSubsidy",key:"provincialSubsidy",width:100,render:e=>E(e)},{title:"省级专项",dataIndex:"provincialSpecialFunds",key:"provincialSpecialFunds",width:100,render:e=>E(e)}]}],z=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"];if(T)return e.jsxs("div",{style:{textAlign:"center",padding:"100px 0"},children:[e.jsx(i,{size:"large"}),e.jsx("p",{style:{marginTop:16},children:"正在生成报表..."})]});if(!A||!D)return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx(r,{icon:e.jsx(c,{}),onClick:()=>L("/"),className:"back-button",children:"返回主页"}),e.jsx("h2",{style:{margin:"16px 0",color:"#333"},children:"智慧报表生成"})]}),e.jsx("div",{className:"content-container",children:e.jsx(s,{description:"没有数据，请先在基础数据模块中添加资金安排数据",image:s.PRESENTED_IMAGE_SIMPLE,children:e.jsx(r,{type:"primary",onClick:()=>L("/basic-data"),children:"前往基础数据"})})})]});const J=[{name:"地方资金",value:A.totalStats.totalLocalFunding,color:z[0]},{name:"中央资金",value:A.totalStats.totalCentralFunding,color:z[1]},{name:"省级资金",value:A.totalStats.totalProvincialFunding,color:z[2]}].filter(e=>e.value>0),M=A.areaStats.map(e=>({area:e.area,"地方资金":e.localFunding,"中央资金":e.centralFunding,"省级资金":e.provincialFunding}));return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx(r,{icon:e.jsx(c,{}),onClick:()=>L("/"),className:"back-button",children:"返回主页"}),e.jsx("h2",{style:{margin:"16px 0",color:"#333"},children:"智慧报表生成"}),e.jsx(r,{type:"primary",onClick:$,children:"刷新报表"})]}),e.jsxs("div",{className:"content-container",children:[e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"value",children:A.totalStats.totalProjects}),e.jsx("div",{className:"label",children:"项目总数"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"value",children:E(A.totalStats.totalBudget)}),e.jsx("div",{className:"label",children:"概算总额(万元)"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"value",children:E(A.totalStats.totalFunding)}),e.jsx("div",{className:"label",children:"资金总额(万元)"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"value",children:E(A.totalStats.totalLocalFunding)}),e.jsx("div",{className:"label",children:"地方资金(万元)"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"value",children:E(A.totalStats.totalCentralFunding)}),e.jsx("div",{className:"label",children:"中央资金(万元)"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"value",children:E(A.totalStats.totalProvincialFunding)}),e.jsx("div",{className:"label",children:"省级资金(万元)"})]})]}),e.jsxs(o,{gutter:[24,24],style:{marginBottom:24},children:[e.jsx(u,{xs:24,lg:12,children:e.jsx(g,{title:"资金来源分布",extra:e.jsx(p,{}),children:e.jsx(j,{width:"100%",height:300,children:e.jsxs(v,{children:[e.jsx(h,{data:J,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:a})=>`${e} ${(100*a).toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:J.map((a,n)=>e.jsx(S,{fill:a.color},`cell-${n}`))}),e.jsx(b,{formatter:e=>E(e)+"万元"})]})})})}),e.jsx(u,{xs:24,lg:12,children:e.jsx(g,{title:"各区域资金分布",extra:e.jsx(m,{}),children:e.jsx(j,{width:"100%",height:300,children:e.jsxs(B,{data:M,children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"area"}),e.jsx(N,{}),e.jsx(b,{formatter:e=>E(e)+"万元"}),e.jsx(f,{}),e.jsx(w,{dataKey:"地方资金",stackId:"a",fill:z[0]}),e.jsx(w,{dataKey:"中央资金",stackId:"a",fill:z[1]}),e.jsx(w,{dataKey:"省级资金",stackId:"a",fill:z[2]})]})})})})]}),e.jsxs(F,{defaultActiveKey:"summary",children:[e.jsxs(P,{tab:"智慧报表总表",children:[e.jsx("div",{className:"table-actions",children:e.jsx(r,{icon:e.jsx(y,{}),onClick:()=>{if(!A||!A.projectSummary)return void d.warning("没有数据可导出");const e=A.projectSummary.map(e=>({"项目名称":e.projectName,"项目编码":e.projectCode,"所属区域":e.area,"项目类别":e.category,"建设单位":e.constructionUnit,"项目主管部门":e.department,"概算批复金额(万元)":e.budgetAmount,"地方资金合计(万元)":e.localFunding,"中央资金合计(万元)":e.centralFunding,"省级资金合计(万元)":e.provincialFunding,"资金总计(万元)":e.totalFunding}));t(e,"智慧报表总表","总表")?d.success("导出成功"):d.error("导出失败")},children:"导出总表"})}),e.jsx(x,{columns:O,dataSource:A.projectSummary,scroll:{x:1200,y:600},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 个项目`}})]},"summary"),e.jsxs(P,{tab:"智慧报表细分表",children:[e.jsx("div",{className:"table-actions",children:e.jsx(r,{icon:e.jsx(y,{}),onClick:()=>{if(!D||!D.projectSummary)return void d.warning("没有数据可导出");const e=D.projectSummary.map(e=>({"项目名称":e.projectName,"项目编码":e.projectCode,"所属区域":e.area,"项目类别":e.category,"地方-一般债券":e.localGeneralBonds,"地方-专项债券":e.localSpecialBonds,"地方-土地出让金":e.landSaleRevenue,"地方-一般公共预算":e.generalPublicBudget,"中央-预算内投资":e.centralBudgetInvestment,"中央-中央补助":e.centralSubsidy,"中央-中央专项":e.centralSpecialFunds,"中央-国债":e.treasuryBonds,"中央-超长期国债":e.ultraLongTreasuryBonds,"中央-抗疫特别国债":e.antiEpidemicBonds,"省级-省级补助":e.provincialSubsidy,"省级-省级专项":e.provincialSpecialFunds}));t(e,"智慧报表细分表","细分表")?d.success("导出成功"):d.error("导出失败")},children:"导出细分表"})}),e.jsx(x,{columns:U,dataSource:D.projectSummary,scroll:{x:1800,y:600},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 个项目`}})]},"detailed"),e.jsx(P,{tab:"区域统计",children:e.jsx(x,{columns:[{title:"区域",dataIndex:"area",key:"area"},{title:"项目数量",dataIndex:"projectCount",key:"projectCount"},{title:"资金总额(万元)",dataIndex:"totalFunding",key:"totalFunding",render:E},{title:"地方资金(万元)",dataIndex:"localFunding",key:"localFunding",render:E},{title:"中央资金(万元)",dataIndex:"centralFunding",key:"centralFunding",render:E},{title:"省级资金(万元)",dataIndex:"provincialFunding",key:"provincialFunding",render:E}],dataSource:A.areaStats,pagination:!1})},"area"),e.jsx(P,{tab:"类别统计",children:e.jsx(x,{columns:[{title:"项目类别",dataIndex:"category",key:"category"},{title:"项目数量",dataIndex:"projectCount",key:"projectCount"},{title:"资金总额(万元)",dataIndex:"totalFunding",key:"totalFunding",render:E},{title:"地方资金(万元)",dataIndex:"localFunding",key:"localFunding",render:E},{title:"中央资金(万元)",dataIndex:"centralFunding",key:"centralFunding",render:E},{title:"省级资金(万元)",dataIndex:"provincialFunding",key:"provincialFunding",render:E}],dataSource:A.categoryStats,pagination:!1})},"category")]})]})]})};export{L as default};
